<div class="min-h-screen bg-white">
  <!-- Sticky header with back button -->
  <div class="sticky top-0 bg-white border-b border-gray-200 z-10">
    <div class="px-4 py-3">
      <button
        (click)="goBack()"
        class="text-green-600 hover:text-green-700 p-2 rounded-lg hover:bg-green-50 transition-colors flex items-center gap-2"
      >
        <svg class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M15 19l-7-7 7-7" />
        </svg>
        {{ 'BLOG.BACK' | translate }}
      </button>
    </div>
  </div>

  <!-- Blog post content -->
  <article class="max-w-4xl mx-auto px-4 py-6" *ngIf="blogPost$ | async as blog">
    <div class="mb-6">
      <!-- Featured image (only if exists) -->
      <img
        *ngIf="blog.imageUrl"
        [src]="blog.imageUrl"
        [alt]="blog.title | translate"
        class="w-full h-64 object-cover rounded-lg mb-6"
      />
      
      <!-- Video at top (only if no image exists) -->
      <div *ngIf="!blog.imageUrl && blog.videoUrl" class="mb-6">
        <h3 class="video-title">{{ 'BLOG.VIDEO' | translate }}</h3>
        <div class="video-container loading" style="padding-bottom: 56.25%;">
          <iframe
            *ngIf="isVideoEmbeddable(blog.videoUrl)"
            [src]="getVideoEmbedUrl(blog.videoUrl) | safe:'resourceUrl'"
            class="absolute top-0 left-0 w-full h-full rounded-lg"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            loading="lazy"
            (load)="onIframeLoad($event)"
            (error)="onIframeError($event)"
          ></iframe>
          <video
            *ngIf="!isVideoEmbeddable(blog.videoUrl) && isVideoPlayable(blog.videoUrl)"
            [src]="blog.videoUrl"
            class="absolute top-0 left-0 w-full h-full rounded-lg"
            controls
            preload="metadata"
            loading="lazy"
            (loadstart)="onVideoLoadStart($event)"
            (canplay)="onVideoCanPlay($event)"
            (error)="onVideoError($event)"
          >
            {{ 'BLOG.VIDEO_NOT_SUPPORTED' | translate }}
          </video>
          <div
            *ngIf="!isVideoPlayable(blog.videoUrl)"
            class="absolute top-0 left-0 w-full h-full flex items-center justify-center bg-gray-100 rounded-lg"
          >
            <div class="text-center p-6">
              <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              <p class="text-gray-600 text-sm">{{ 'BLOG.VIDEO_UNAVAILABLE' | translate }}</p>
              <a
                *ngIf="isVideoEmbeddable(blog.videoUrl)"
                [href]="blog.videoUrl"
                target="_blank"
                rel="noopener noreferrer"
                class="inline-block mt-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"
              >
                {{ 'BLOG.WATCH_ON_PLATFORM' | translate }}
              </a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Title -->
      <h1 class="text-3xl font-bold text-gray-900 mb-4">
        {{ blog.title | translate }}
      </h1>
      
      <!-- Meta information -->
      <div class="flex items-center gap-4 text-sm text-gray-600 mb-6">
        <div class="flex items-center gap-1">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
            <circle cx="12" cy="7" r="4" />
          </svg>
          <span>{{ blog.author | translate }}</span>
        </div>
        <div class="flex items-center gap-1">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" />
            <polyline points="12 6 12 12 16 14" />
          </svg>
          <span>{{ blog.readTime }}</span>
        </div>
        <span>{{ blog.date | date:'mediumDate' }}</span>
      </div>
    </div>

    <!-- Full content -->
    <div class="prose max-w-none">
      <div class="text-gray-700 leading-relaxed whitespace-pre-line text-base">
        {{ blog.fullContent }}
      </div>
    </div>

    <!-- Video section below text (only when both image and video exist) -->
    <div *ngIf="blog.imageUrl && blog.videoUrl" class="mt-8">
      <h3 class="video-title">{{ 'BLOG.VIDEO' | translate }}</h3>
      <div class="video-container loading" style="padding-bottom: 56.25%;">
        <iframe
          *ngIf="isVideoEmbeddable(blog.videoUrl)"
          [src]="getVideoEmbedUrl(blog.videoUrl) | safe:'resourceUrl'"
          class="absolute top-0 left-0 w-full h-full rounded-lg"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy"
          (load)="onIframeLoad($event)"
          (error)="onIframeError($event)"
        ></iframe>
        <video
          *ngIf="!isVideoEmbeddable(blog.videoUrl) && isVideoPlayable(blog.videoUrl)"
          [src]="blog.videoUrl"
          class="absolute top-0 left-0 w-full h-full rounded-lg"
          controls
          preload="metadata"
          loading="lazy"
          (loadstart)="onVideoLoadStart($event)"
          (canplay)="onVideoCanPlay($event)"
          (error)="onVideoError($event)"
        >
          {{ 'BLOG.VIDEO_NOT_SUPPORTED' | translate }}
        </video>
        <div
          *ngIf="!isVideoPlayable(blog.videoUrl)"
          class="absolute top-0 left-0 w-full h-full flex items-center justify-center bg-gray-100 rounded-lg"
        >
          <div class="text-center p-6">
            <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            <p class="text-gray-600 text-sm">{{ 'BLOG.VIDEO_UNAVAILABLE' | translate }}</p>
            <a
              *ngIf="isVideoEmbeddable(blog.videoUrl)"
              [href]="blog.videoUrl"
              target="_blank"
              rel="noopener noreferrer"
              class="inline-block mt-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"
            >
              {{ 'BLOG.WATCH_ON_PLATFORM' | translate }}
            </a>
          </div>
        </div>
      </div>
    </div>
  </article>

  <!-- Loading state -->
  <div class="flex justify-center items-center min-h-screen" *ngIf="!(blogPost$ | async)">
    <div class="text-gray-500">{{ 'BLOG.LOADING_SINGLE' | translate }}</div>
  </div>
</div> 